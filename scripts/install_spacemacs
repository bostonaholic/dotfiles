#!/bin/bash
################################################################################
# Install Spacemacs
#
# DESCRIPTION:
#   Installs Spacemacs, a community-driven Emacs distribution with better
#   defaults and an extensive layer system. Uses the develop branch.
#
# USAGE:
#   Called by install.sh, or run directly:
#   ./install_spacemacs
#
# ENVIRONMENT VARIABLES:
#   DRY_RUN  - If true, preview changes without making them (default: false)
#   VERBOSE  - If true, show detailed output (default: false)
#
# WHAT IT DOES:
#   1. Checks if ~/.emacs.d directory exists
#   2. If not present, clones Spacemacs repository
#   3. Checks out the 'develop' branch (recommended)
#   4. Skips if Spacemacs is already installed
#
# DEPENDENCIES:
#   - git (for cloning repository)
#   - emacs (must be installed separately)
#   - Internet connection
#
# NOTES:
#   First launch of Emacs will trigger Spacemacs initialization and
#   package installation, which may take several minutes.
#   Configure Spacemacs by editing ~/.spacemacs after first launch.
#
################################################################################

set -euo pipefail

# shellcheck source=lib.sh
source "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)/lib.sh"

main() {
    local directory="$HOME/.emacs.d"

    if [[ -d "$directory" ]]; then
        log "Spacemacs is already installed, skipping"
        return
    fi

    if [[ $DRY_RUN == true ]]; then
        log "[DRY RUN] Would install Spacemacs"
        return
    fi

    log "Installing Spacemacs..."
    git clone https://github.com/syl20bnr/spacemacs "$directory"
    (
        cd "$directory"
        git checkout develop
    )
    success "Spacemacs installed"
}

# Run if executed directly
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
