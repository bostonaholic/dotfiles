#!/bin/bash
################################################################################
# Install nodenv and Node.js
#
# DESCRIPTION:
#   Installs nodenv (Node.js version manager) and a specific Node.js version.
#   Manages multiple Node.js versions on the same machine.
#
# USAGE:
#   ./install_nodenv
#
# WHAT IT DOES:
#   1. Checks if nodenv is installed, installs via Homebrew if missing
#   2. Installs the specified Node.js version using nodenv
#   3. Sets the installed version as the global default
#   4. Runs 'nodenv rehash' to make Node.js commands available
#   5. Skips if nodenv and the version are already installed
#
# DEPENDENCIES:
#   - homebrew (for installing nodenv)
#   - Internet connection
#
# CONFIGURATION:
#   - VERSION variable at top of script specifies Node.js version to install
#
# NOTES:
#   After installation, add 'eval "$(nodenv init -)"' to your shell profile.
#   This is typically done automatically by dotfiles symlinks.
#
################################################################################

VERSION='22.15.1'

function install_global_node() {
    nodenv install $VERSION
    nodenv global $VERSION
    nodenv rehash
}

if [ ! -d "$HOME/.nodenv" ]; then
    echo 'Setting up nodenv...'
    brew install nodenv

    echo "nodenv is now set up! Installing latest Node..."
    install_global_node
else
    echo 'nodenv is already installed on this machine.'

    if [ ! -d "$HOME/.nodenv/versions/$VERSION" ]; then
        install_global_node
    else
        echo "Node $VERSION is already installed on this machine."
    fi
fi
