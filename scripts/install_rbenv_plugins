#!/bin/bash
################################################################################
# Install rbenv Plugins
#
# DESCRIPTION:
#   Installs useful rbenv plugins for Ruby version management.
#   Clones plugin repositories into rbenv plugins directory.
#
# USAGE:
#   Called by install.sh, or run directly:
#   ./install_rbenv_plugins
#
# PLUGINS INSTALLED:
#   - rbenv-default-gems: Automatically installs gems when installing new Ruby
#   - rbenv-ctags: Generates ctags for installed Ruby versions
#
# WHAT IT DOES:
#   1. Creates plugins directory in rbenv root if needed
#   2. Clones each plugin from GitHub (only if not already present)
#   3. Runs 'rbenv rehash' to make plugins available
#
# DEPENDENCIES:
#   - rbenv (must be installed)
#   - git (for cloning repositories)
#   - Internet connection
#
# NOTES:
#   Plugins are cloned via SSH (git@github.com). Ensure SSH keys are set up.
#
################################################################################

mkdir -p "$(rbenv root)/plugins"

plugins=(
    'rbenv/rbenv-default-gems'
    'tpope/rbenv-ctags'
)

for plugin in "${plugins[@]}"
do
    plugin_name=$(echo "${plugin}" | cut -d '/' -f 2)
    plugin_repo="git@github.com:${plugin}.git"

    # Only clone the plugin if it doesn't already exist
    if [ ! -d "$(rbenv root)/plugins/${plugin_name}" ]; then
        git clone "${plugin_repo}" "$(rbenv root)/plugins/${plugin_name}"
    fi
done

# Ensure the new plugins are available
rbenv rehash