#!/usr/bin/env bash

#
# $ build -t <token> [-p <project>] [-v <vcs>] [-o <owner>] [-b <branch>]
#

while getopts ":t:p:v:o:b:" opt; do
    case $opt in
        t)
            TOKEN=$OPTARG
            ;;
        p)
            PROJECT=$OPTARG
            ;;
        v)
            VCS=$OPTARG
            ;;
        o)
            OWNER=$OPTARG
            ;;
        b)
            BRANCH=$OPTARG
            ;;
    esac
done

if [ -z $TOKEN ]; then
    echo "-t <token> is required"
    exit 1
fi

if [ -z $PROJECT]; then PROJECT="test-github-project"; fi
if [ -z $VCS ]; then VCS="github"; fi
if [ -z $OWNER ]; then OWNER="bostonaholic"; fi
if [ -z $BRANCH ]; then BRANCH="master"; fi

REQUEST="http://dev.circlehost:8080/api/v1.1/project/$VCS/$OWNER/$PROJECT/tree/$BRANCH?circle-token=$TOKEN"
echo "POST $REQUEST"
curl POST --header "Content-Type: application/json" -d '{}' "$REQUEST"
