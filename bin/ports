#!/bin/bash
################################################################################
# Ports - List Listening TCP Ports
#
# DESCRIPTION:
#   Lists processes listening on TCP ports, optionally filtered by pattern.
#
# USAGE:
#   ports [pattern]
#
# ARGUMENTS:
#   pattern  - Optional pattern to filter results (case-insensitive)
#
# EXAMPLES:
#   ports            # Show all listening ports
#   ports rails      # Show only ports with "rails" in process name
#   ports 3000       # Show processes on port 3000
#
# DEPENDENCIES:
#   - lsof (for listing open files/ports)
#
################################################################################

set -eu -o pipefail

pattern="${1:-}"

if [ -z "$pattern" ]; then
  lsof -iTCP -sTCP:LISTEN -P
else
  lsof -iTCP -sTCP:LISTEN -P | awk -v pat="$pattern" 'NR==1{h=$0;next} tolower($0)~tolower(pat){if(h){print h;h=""}print}'
fi
