#!/bin/bash
################################################################################
# Docker Cleanup
#
# DESCRIPTION:
#   Removes all Docker containers, images, and dangling volumes.
#   Useful for reclaiming disk space and starting fresh.
#
# USAGE:
#   docker-cleanup
#
# WARNING:
#   This will DELETE ALL Docker containers, images, and dangling volumes.
#   Make sure you don't have important containers or images before running!
#
# WHAT IT DOES:
#   1. Removes all containers (running and stopped)
#   2. Removes all images (forced removal)
#   3. Removes all dangling volumes (volumes not used by any container)
#
# DEPENDENCIES:
#   - docker
#   - ~/.colors (for colored output)
#
# NOTES:
#   This is a destructive operation. Use with caution.
#   The script will show colored output during execution.
#
################################################################################

set -eux -o pipefail

# shellcheck disable=SC1091
source "${HOME}/.colors"

function remove_all_containers {
    docker ps --all | sed '1 d' | awk '{print $1}' | xargs -L1 docker rm
}

function remove_all_images {
    docker images --all | sed '1 d' | awk '{print $3}' | xargs -L1 docker rmi --force
}

function remove_dangling_volumes {
    local dangling_volumes
    dangling_volumes="$(docker volume ls --quiet --filter dangling=true)"
    if [ -n "$dangling_volumes" ]; then
        echo "$dangling_volumes" | xargs docker volume rm "$dangling_volumes"
    fi
}

printf "%b===>%b remove all containers%b\n" "${GREEN}" "${WHITE_BOLD}" "${NO_COLOR} "&& \
    remove_all_containers

printf "%b===>%b remove all images%b\n" "${GREEN}" "${WHITE_BOLD}" "${NO_COLOR}" && \
    remove_all_images

printf "%b===>%b remove dangling volumes%b\n" "${GREEN}" "${WHITE_BOLD}" "${NO_COLOR}" && \
    remove_dangling_volumes
